<app-navbar></app-navbar>

<div class="units-hero-section">
  <div class="hero-overlay">
    <div class="hero-content">
      <h1>Discover Amazing Properties</h1>
      <p>Find your perfect accommodation from our extensive collection</p>

      <div class="hero-stats">
        <div class="stat-item">
          <span class="stat-number">{{ allUnits.length }}</span>
          <span class="stat-label">Properties</span>
        </div>
        <div class="stat-item">
          <span class="stat-number">{{ villageOptions.length }}</span>
          <span class="stat-label">Locations</span>
        </div>
        <div class="stat-item">
          <span class="stat-number">24/7</span>
          <span class="stat-label">Support</span>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid">
  <div class="row">
    <div class="col-lg-3">
      <div class="sidebar">
        <h5 class="sidebar-title">Filter Properties</h5>

        <div class="filter-section">
          <h6>Location</h6>
          <ul class="city-list">
            <li *ngFor="let village of villageOptions">
              <a href="#"
                 [class.active]="selectedVillage === village.name"
                 (click)="filterByCity(village.name, $event)">
                <i class="fas fa-map-marker-alt"></i>
                {{ village.name }}
                <span class="count">({{ village.count }})</span>
              </a>
            </li>
          </ul>
        </div>

        <div class="filter-section">
          <h6>Property Type</h6>
          <ul class="city-list">
            <li *ngFor="let type of unitTypeOptions">
              <a href="#"
                 [class.active]="selectedType === type.name"
                 (click)="filterByType(type.name, $event)">
                <i class="fas fa-home"></i>
                {{ type.name }}
                <span class="count">({{ type.count }})</span>
              </a>
            </li>
          </ul>
        </div>

        <div class="filter-section">
          <h6>Bedrooms</h6>
          <select class="form-select" [(ngModel)]="selectedBedrooms" (change)="applyBedroomsBathroomsFilter()">
            <option value="">Any</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4+">4+</option>
          </select>
        </div>

        <div class="filter-section">
          <h6>Bathrooms</h6>
          <select class="form-select" [(ngModel)]="selectedBathrooms" (change)="applyBedroomsBathroomsFilter()">
            <option value="">Any</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3+">3+</option>
          </select>
        </div>

        <div class="filter-section">
          <h6>Price Range</h6>
          <div class="price-inputs">
            <input type="number"
                   class="form-control mb-2"
                   placeholder="Min Price"
                   [(ngModel)]="minPrice"
                   (change)="applyPriceFilter()">
            <input type="number"
                   class="form-control"
                   placeholder="Max Price"
                   [(ngModel)]="maxPrice"
                   (change)="applyPriceFilter()">
          </div>
        </div>
      </div>
    </div>

    <div class="col-lg-9">
      <div class="main-content">
        <div class="content-header d-flex justify-content-between align-items-center mb-4">
          <div>
            <h4>All Properties</h4>
            <p class="text-muted">{{ filteredUnits.length }} properties found</p>
          </div>

          <div class="sort-controls">
            <label class="form-label me-2">Sort by:</label>
            <select
              #sortSelect
              class="form-select w-auto"
              (change)="sortBy(sortSelect.value)"
            >
              <option value="default">Default</option>
              <option value="price-low">Price: Low to High</option>
              <option value="price-high">Price: High to Low</option>
            </select>
          </div>
        </div>

        <div *ngIf="isLoading" class="text-center py-5">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <p class="mt-2">Loading units...</p>
        </div>

        <div *ngIf="error" class="alert alert-danger text-center" role="alert">
          {{ error }}
        </div>

        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
          <div class="col" *ngFor="let unit of paginatedUnits">
            <div
              class="card h-100 unit-card"
              (click)="viewUnitDetails(unit.id)"
              (keydown.enter)="viewUnitDetails(unit.id)"
              (keydown.space)="viewUnitDetails(unit.id)"
              tabindex="0"
              role="button"
              [attr.aria-label]="'View details for ' + unit.title"
              style="cursor: pointer;"
            >
              <img
                [src]="getUnitImagePath(unit)"
                class="card-img-top"
                alt="Unit Image"
                style="height: 200px; object-fit: cover"
                (error)="onImageError($event)"
              />
              <div class="card-body d-flex flex-column">
                <h5 class="card-title">{{ unit.title }}</h5>
                <p class="property-address">
                  <i class="fas fa-map-marker-alt me-2"></i>{{ unit.address }}, {{
                  unit.villageName }}
                </p>
                <p class="property-price">
                  EGP {{ unit.basePricePerNight | number:'1.2-2' }} / night
                </p>
                <div
                  class="property-details mt-auto d-flex justify-content-between align-items-center pt-3 border-top"
                >
                  <div>
                    <i class="fas fa-bed me-1"></i> {{ unit.bedrooms }} Beds
                  </div>
                  <div>
                    <i class="fas fa-bath me-1"></i> {{ unit.bathrooms }} Baths
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div
            *ngIf="paginatedUnits.length === 0 && !isLoading && !error"
            class="col-12 text-center text-muted py-5"
          >
            No units found matching your criteria.
          </div>
        </div>

        <nav aria-label="Page navigation" class="mt-4">
          <ul class="pagination justify-content-center">
            <li class="page-item" [class.disabled]="currentPage === 1">
              <a
                class="page-link"
                href="javascript:void(0)"
                aria-label="Previous"
                (click)="previousPage()"
              >
                <span aria-hidden="true">&laquo;</span>
              </a>
            </li>
            <li
              class="page-item"
              *ngFor="let page of [].constructor(totalPages); let i = index"
              [class.active]="(i + 1) === currentPage"
            >
              <a
                class="page-link"
                href="javascript:void(0)"
                (click)="goToPage(i + 1)"
                >{{ i + 1 }}</a
              >
            </li>
            <li class="page-item" [class.disabled]="currentPage === totalPages">
              <a
                class="page-link"
                href="javascript:void(0)"
                aria-label="Next"
                (click)="nextPage()"
              >
                <span aria-hidden="true">&raquo;</span>
              </a>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
</div>
